pipeline {
  agent any
  environment {
    DB_URL = "jdbc:postgresql://postgres:5432/database_a"
    DB_USERNAME = "postgres"
    DB_PASSWORD = "1234"
    CHANGELOG_FILE = "/var/jenkins_home/db/liquibase.changelog.yml" // Path to your changelog
  }
  options {
    // This is required if you want to clean before build
    skipDefaultCheckout(true)
  }
  stages {
    stage('Check tag exist') {
      steps {
          sh "liquibase --url='${DB_URL}' --username='${DB_USERNAME}' --password='${DB_PASSWORD}' --changeLogFile='${CHANGELOG_FILE}' tag-exists --tag=1.0.1"
      }
    }
    stage('Rollback') {
      steps {
          sh "liquibase --url='${DB_URL}' --username='${DB_USERNAME}' --password='${DB_PASSWORD}' --changeLogFile='${CHANGELOG_FILE}' rollback 1.0.0"
      }
    }
  }
  post {
    always {
      cleanWs() // Clean up workspace after build
    }
    failure {
    }
  }
}